/* === TTRPG Tools - Global Styles === */
:root {
  --bg: #0a0a12;
  --bg2: #12121f;
  --bg3: #1a1a2e;
  --bg4: #22223a;
  --accent: #e94560;
  --accent2: #ff6b6b;
  --gold: #c9a227;
  --gold2: #e8c547;
  --blue: #4a9eff;
  --green: #4ade80;
  --purple: #a78bfa;
  --orange: #fb923c;
  --cyan: #22d3ee;
  --text: #d4d4e0;
  --text2: #9999b0;
  --text3: #55556a;
  --border: #1e1e35;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

/* === HEADER === */
.site-header {
  background: linear-gradient(135deg, var(--bg2), var(--bg3));
  padding: 16px 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
  position: sticky;
  top: 0;
  z-index: 100;
}
.site-header h1 { font-size: 1.5em; color: var(--accent); font-weight: 700; white-space: nowrap; }
.site-header h1 span { color: var(--text3); font-weight: 400; font-size: 0.6em; display: block; }
.site-nav { display: flex; gap: 4px; margin-left: auto; flex-wrap: wrap; }
.nav-btn {
  padding: 8px 14px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text2);
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.82em;
  transition: all 0.15s;
  text-decoration: none;
  white-space: nowrap;
}
.nav-btn:hover { border-color: var(--accent); color: var(--text); }
.nav-btn.active { background: var(--accent); border-color: var(--accent); color: #fff; }

/* === MAIN CONTENT === */
main { max-width: 1100px; margin: 0 auto; padding: 24px 20px 80px; }

/* === TOOL CARDS (HOME) === */
.tools-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 14px;
  margin-bottom: 32px;
}
.tool-card {
  background: linear-gradient(135deg, var(--bg3), var(--bg4));
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 20px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 16px;
}
.tool-card:hover { border-color: var(--accent); transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.3); }
.tool-card .tc-icon { font-size: 2.2em; flex-shrink: 0; }
.tool-card .tc-info h3 { font-size: 1em; margin-bottom: 3px; }
.tool-card .tc-info p { font-size: 0.78em; color: var(--text2); }
.tool-card.tc-red { border-color: rgba(233,69,96,0.3); background: linear-gradient(135deg, rgba(233,69,96,0.08), var(--bg3)); }
.tool-card.tc-gold { border-color: rgba(201,162,39,0.3); background: linear-gradient(135deg, rgba(201,162,39,0.08), var(--bg3)); }
.tool-card.tc-blue { border-color: rgba(74,158,255,0.3); background: linear-gradient(135deg, rgba(74,158,255,0.08), var(--bg3)); }
.tool-card.tc-purple { border-color: rgba(167,139,250,0.3); background: linear-gradient(135deg, rgba(167,139,250,0.08), var(--bg3)); }
.tool-card.tc-green { border-color: rgba(74,222,128,0.3); background: linear-gradient(135deg, rgba(74,222,128,0.08), var(--bg3)); }
.tool-card.tc-cyan { border-color: rgba(34,211,238,0.3); background: linear-gradient(135deg, rgba(34,211,238,0.08), var(--bg3)); }

/* === TOOL SECTIONS === */
.tool-section {
  display: none;
  animation: fadeIn 0.3s ease;
}
.tool-section.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.section-head {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border);
}
.section-head h2 { font-size: 1.3em; color: var(--accent); }
.section-head .sh-icon { font-size: 1.5em; }
.back-btn {
  padding: 6px 12px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--text2);
  cursor: pointer;
  font-size: 0.82em;
  margin-left: auto;
}
.back-btn:hover { border-color: var(--accent); color: var(--text); }

/* === PANELS & INPUTS === */
.panel {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
}
.panel-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}
.panel-head h3 { font-size: 1em; color: var(--text); }

.input-row { display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; }
.input-row input, .input-row select {
  padding: 8px 12px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  font-size: 0.88em;
  outline: none;
  font-family: inherit;
}
.input-row input:focus, .input-row select:focus { border-color: var(--accent); }
.input-row select { cursor: pointer; }

.btn {
  padding: 8px 16px;
  border: none;
  border-radius: 8px;
  font-size: 0.85em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
  font-family: inherit;
}
.btn-primary { background: var(--accent); color: #fff; }
.btn-primary:hover { background: var(--accent2); }
.btn-secondary { background: var(--bg3); border: 1px solid var(--border); color: var(--text); }
.btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
.btn-small { padding: 5px 10px; font-size: 0.78em; }
.btn-danger { background: transparent; border: 1px solid var(--accent); color: var(--accent); }
.btn-danger:hover { background: var(--accent); color: #fff; }
.btn-gold { background: var(--gold); color: #000; }
.btn-gold:hover { background: var(--gold2); }

/* === DICE ROLLER === */
.dice-quick { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-bottom: 12px; }
.dice-btn {
  padding: 12px 4px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  font-size: 0.9em;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.15s;
}
.dice-btn:hover { background: var(--bg4); border-color: var(--accent); transform: translateY(-2px); }
.dice-btn:active { transform: scale(0.95); }
.dice-btn.d20 { background: linear-gradient(135deg, var(--accent), #d93550); border-color: var(--accent); color: #fff; grid-column: span 2; }
.dice-btn.d20:hover { background: linear-gradient(135deg, var(--accent2), var(--accent)); }

.dice-adv { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 12px; }
.dice-adv button {
  padding: 8px;
  background: var(--bg4);
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--text2);
  font-size: 0.78em;
  cursor: pointer;
  transition: all 0.15s;
}
.dice-adv button:hover { border-color: var(--blue); color: var(--text); }

.dice-result {
  background: var(--bg);
  border: 2px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 14px;
  text-align: center;
  transition: border-color 0.3s;
}
.dice-result.crit { border-color: var(--green); }
.dice-result.fail { border-color: var(--accent); }
.dice-val {
  font-size: 3.5em;
  font-weight: 800;
  color: var(--accent);
  line-height: 1;
  font-variant-numeric: tabular-nums;
  transition: color 0.3s;
}
.dice-val.nat20 { color: var(--green); animation: dpulse 0.4s; }
.dice-val.nat1 { color: var(--accent); animation: dshake 0.4s; }
@keyframes dpulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.15); } }
@keyframes dshake { 0%,100% { transform: rotate(0); } 25% { transform: rotate(-8deg); } 75% { transform: rotate(8deg); } }
.dice-formula { font-size: 0.85em; color: var(--text3); margin-top: 4px; }
.dice-breakdown { font-size: 0.78em; color: var(--text2); margin-top: 6px; padding: 6px 10px; background: var(--bg3); border-radius: 4px; display: none; }
.dice-breakdown.visible { display: block; }

.dice-hist-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; font-size: 0.78em; color: var(--text3); text-transform: uppercase; letter-spacing: 1px; }
.dice-hist { max-height: 200px; overflow-y: auto; display: flex; flex-direction: column; gap: 3px; }
.dice-hist-item {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 5px;
  padding: 5px 10px;
  font-size: 0.82em;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.dice-hist-f { color: var(--text2); font-family: monospace; }
.dice-hist-r { font-weight: 700; font-variant-numeric: tabular-nums; }
.dice-hist-r.nat20 { color: var(--green); }
.dice-hist-r.nat1 { color: var(--accent); }
.dice-hist-empty { text-align: center; color: var(--text3); font-size: 0.82em; padding: 16px; }

/* === ORACLE === */
.oracle-likelihood { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin-bottom: 14px; }
.oracle-btn {
  padding: 10px 4px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text2);
  font-size: 0.75em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
  text-align: center;
}
.oracle-btn:hover { border-color: var(--purple); color: var(--text); }
.oracle-btn.active { background: var(--purple); border-color: var(--purple); color: #fff; }

.oracle-result {
  background: var(--bg);
  border: 2px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  text-align: center;
  margin-bottom: 14px;
  min-height: 120px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: border-color 0.3s;
}
.oracle-answer { font-size: 2em; font-weight: 800; line-height: 1.2; }
.oracle-answer.yes { color: var(--green); }
.oracle-answer.no { color: var(--accent); }
.oracle-answer.exceptional { text-shadow: 0 0 20px currentColor; }
.oracle-event { font-size: 0.85em; color: var(--gold); margin-top: 8px; padding: 6px 12px; background: rgba(201,162,39,0.1); border-radius: 6px; }
.oracle-detail { font-size: 0.82em; color: var(--text2); margin-top: 6px; }

.chaos-meter { display: flex; align-items: center; gap: 8px; margin-bottom: 14px; }
.chaos-meter label { font-size: 0.82em; color: var(--text2); font-weight: 600; }
.chaos-bar { display: flex; gap: 3px; flex: 1; }
.chaos-pip {
  flex: 1;
  height: 8px;
  background: var(--bg4);
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.2s;
}
.chaos-pip.filled { background: var(--purple); }
.chaos-pip.filled.high { background: var(--accent); }
.chaos-val { font-size: 0.85em; font-weight: 700; color: var(--purple); min-width: 20px; text-align: center; }

.meaning-result {
  background: var(--bg3);
  border-radius: 8px;
  padding: 12px;
  text-align: center;
  margin-top: 10px;
}
.meaning-words { font-size: 1.1em; font-weight: 700; color: var(--cyan); }
.meaning-label { font-size: 0.75em; color: var(--text3); margin-top: 3px; text-transform: uppercase; letter-spacing: 1px; }

/* === RANDOM TABLES === */
.table-list { display: flex; flex-direction: column; gap: 8px; }
.table-item {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 12px 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  transition: all 0.15s;
}
.table-item:hover { border-color: var(--gold); background: var(--bg4); }
.table-item .ti-icon { font-size: 1.3em; }
.table-item .ti-info { flex: 1; }
.table-item .ti-name { font-size: 0.9em; font-weight: 600; }
.table-item .ti-desc { font-size: 0.75em; color: var(--text3); }
.table-item .ti-count { font-size: 0.72em; color: var(--text3); background: var(--bg); padding: 2px 8px; border-radius: 4px; }

.table-result {
  background: var(--bg);
  border: 2px solid var(--gold);
  border-radius: 10px;
  padding: 16px;
  margin-bottom: 14px;
  text-align: center;
}
.table-result-val { font-size: 1.2em; font-weight: 700; color: var(--gold); }
.table-result-src { font-size: 0.75em; color: var(--text3); margin-top: 4px; }

/* === INITIATIVE TRACKER === */
.init-list { display: flex; flex-direction: column; gap: 4px; margin-bottom: 14px; }
.init-item {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 10px 14px;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.15s;
}
.init-item.current { border-color: var(--green); background: rgba(74,222,128,0.06); }
.init-item .init-order { font-size: 1.2em; font-weight: 800; color: var(--accent); min-width: 32px; text-align: center; font-variant-numeric: tabular-nums; }
.init-item .init-name { flex: 1; font-weight: 600; font-size: 0.92em; }
.init-item .init-hp { font-size: 0.82em; color: var(--green); }
.init-item .init-conds { display: flex; gap: 3px; flex-wrap: wrap; }
.init-cond {
  font-size: 0.68em;
  padding: 1px 6px;
  background: var(--bg4);
  border: 1px solid var(--border);
  border-radius: 3px;
  color: var(--orange);
  cursor: pointer;
}
.init-cond:hover { border-color: var(--accent); }
.init-item .init-acts { display: flex; gap: 4px; }
.init-item .init-acts button {
  background: none;
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--text3);
  cursor: pointer;
  font-size: 0.78em;
  padding: 2px 6px;
}
.init-item .init-acts button:hover { border-color: var(--accent); color: var(--accent); }
.init-controls { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
.round-display { font-size: 0.88em; color: var(--text2); margin-left: auto; }
.round-display strong { color: var(--gold); font-size: 1.1em; }

/* === ENCOUNTER BUILDER === */
.enc-params { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 16px; align-items: flex-end; }
.enc-field { display: flex; flex-direction: column; gap: 4px; }
.enc-field label { font-size: 0.78em; color: var(--text2); font-weight: 600; }
.enc-field input, .enc-field select {
  padding: 8px 12px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  font-size: 0.88em;
  outline: none;
  width: 120px;
}
.enc-field input:focus, .enc-field select:focus { border-color: var(--accent); }
.enc-budget {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 14px;
  margin-bottom: 14px;
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}
.enc-budget-item { text-align: center; }
.enc-budget-item .label { font-size: 0.72em; color: var(--text3); text-transform: uppercase; display: block; }
.enc-budget-item .value { font-size: 1.2em; font-weight: 700; }
.enc-budget-item .value.low { color: var(--green); }
.enc-budget-item .value.moderate { color: var(--gold); }
.enc-budget-item .value.high { color: var(--accent); }
.enc-monsters { display: flex; flex-direction: column; gap: 4px; max-height: 300px; overflow-y: auto; }
.enc-monster {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 8px 12px;
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 0.85em;
  cursor: pointer;
  transition: all 0.15s;
}
.enc-monster:hover { border-color: var(--accent); }
.enc-monster .cr { color: var(--gold); font-weight: 700; min-width: 36px; }
.enc-monster .name { flex: 1; }
.enc-monster .type { color: var(--text3); font-size: 0.85em; }
.enc-monster .xp { color: var(--text2); font-size: 0.82em; }
.enc-selected { margin-top: 14px; }
.enc-selected h4 { font-size: 0.88em; color: var(--text2); margin-bottom: 8px; }
.enc-total { font-size: 0.88em; color: var(--text2); margin-top: 10px; padding: 8px 12px; background: var(--bg); border-radius: 6px; display: flex; justify-content: space-between; }
.enc-total .total-xp { font-weight: 700; color: var(--gold); }
.enc-diff { padding: 3px 10px; border-radius: 4px; font-weight: 700; font-size: 0.82em; }
.enc-diff.low { background: rgba(74,222,128,0.15); color: var(--green); }
.enc-diff.moderate { background: rgba(201,162,39,0.15); color: var(--gold); }
.enc-diff.high { background: rgba(233,69,96,0.15); color: var(--accent); }

/* === NPC GENERATOR === */
.npc-card {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 14px;
}
.npc-name { font-size: 1.4em; font-weight: 800; color: var(--accent); margin-bottom: 2px; }
.npc-title { font-size: 0.85em; color: var(--text2); font-style: italic; margin-bottom: 12px; }
.npc-stats {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 6px;
  margin-bottom: 14px;
  padding: 10px;
  background: var(--bg3);
  border-radius: 8px;
}
.npc-stat { text-align: center; }
.npc-stat .stat-name { font-size: 0.65em; color: var(--text3); text-transform: uppercase; font-weight: 700; }
.npc-stat .stat-val { font-size: 1.1em; font-weight: 700; color: var(--text); }
.npc-stat .stat-mod { font-size: 0.75em; color: var(--text2); }
.npc-details { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.npc-detail { }
.npc-detail .label { font-size: 0.72em; color: var(--text3); text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; }
.npc-detail .value { font-size: 0.88em; color: var(--text); margin-top: 2px; }

/* === REFERENCE === */
.ref-section { margin-bottom: 6px; }
.ref-section-head {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 14px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.15s;
  user-select: none;
}
.ref-section-head:hover { border-color: var(--accent); }
.ref-section-head.open { border-radius: 8px 8px 0 0; border-color: var(--accent); }
.ref-icon { font-size: 1.1em; }
.ref-title { font-size: 0.92em; font-weight: 600; flex: 1; }
.ref-count { font-size: 0.72em; color: var(--text3); background: var(--bg); padding: 2px 8px; border-radius: 4px; }
.ref-chevron { font-size: 0.7em; color: var(--text3); }
.ref-section-body {
  display: none;
  border: 1px solid var(--border);
  border-top: none;
  border-radius: 0 0 8px 8px;
  overflow: hidden;
}
.ref-section-body.open { display: block; }
.ref-item {
  padding: 10px 14px;
  border-bottom: 1px solid var(--border);
  transition: background 0.1s;
}
.ref-item:last-child { border-bottom: none; }
.ref-item:hover { background: rgba(233,69,96,0.04); }
.ref-item-name { font-size: 0.88em; font-weight: 700; color: var(--accent); margin-bottom: 2px; }
.ref-item-desc { font-size: 0.82em; color: var(--text2); line-height: 1.5; }
.ref-item mark { background: rgba(201,162,39,0.3); color: var(--text); border-radius: 2px; padding: 0 2px; }

/* === JOURNAL === */
.journal-layout { display: grid; grid-template-columns: 1fr 280px; gap: 16px; }
.journal-session {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 14px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.15s;
  margin-bottom: 6px;
}
.journal-session:hover { border-color: var(--accent); }
.journal-session.active { border-color: var(--green); background: rgba(74,222,128,0.06); }
.js-info { flex: 1; min-width: 0; }
.js-name { font-size: 0.9em; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.js-meta { font-size: 0.72em; color: var(--text3); }
.js-acts { display: flex; gap: 3px; }

.entry-item {
  padding: 10px 14px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  margin-bottom: 6px;
  border-left: 3px solid var(--text3);
}
.entry-narrativa { border-left-color: var(--blue); }
.entry-oraculo { border-left-color: var(--purple); }
.entry-tirada { border-left-color: var(--accent); }
.entry-nota { border-left-color: var(--gold); }
.entry-combate { border-left-color: var(--green); }
.entry-header { display: flex; align-items: center; gap: 6px; margin-bottom: 4px; }
.entry-icon { font-size: 0.9em; }
.entry-type { font-size: 0.7em; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
.entry-time { font-size: 0.7em; color: var(--text3); margin-left: auto; }
.entry-del { background: none; border: none; color: var(--text3); cursor: pointer; font-size: 0.75em; padding: 0 4px; opacity: 0; transition: opacity 0.15s; }
.entry-item:hover .entry-del { opacity: 1; }
.entry-del:hover { color: var(--accent); }
.entry-text { font-size: 0.85em; line-height: 1.5; color: var(--text); }
.entry-timeline { max-height: 400px; overflow-y: auto; margin-bottom: 12px; }

/* Thread tracker */
.thread-panel { background: var(--bg2); border: 1px solid var(--border); border-radius: 12px; padding: 12px; margin-bottom: 12px; }
.thread-panel h4 { font-size: 0.85em; color: var(--text2); margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between; }
.thread-item {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 5px 8px;
  background: var(--bg3);
  border-radius: 5px;
  margin-bottom: 3px;
  font-size: 0.82em;
}
.thread-item.resolved { opacity: 0.5; }
.thread-item.resolved .thread-name { text-decoration: line-through; }
.thread-name { flex: 1; cursor: pointer; }
.thread-del { background: none; border: none; color: var(--text3); cursor: pointer; font-size: 0.75em; opacity: 0; transition: opacity 0.15s; }
.thread-item:hover .thread-del { opacity: 1; }
.thread-del:hover { color: var(--accent); }

/* === THEME SELECTOR === */
.theme-picker { position: relative; }
.theme-btn {
  padding: 6px 10px;
  background: transparent;
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text2);
  cursor: pointer;
  font-size: 0.88em;
  transition: all 0.15s;
}
.theme-btn:hover { border-color: var(--accent); }
.theme-menu {
  display: none;
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 6px;
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 6px;
  z-index: 200;
  min-width: 160px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.5);
}
.theme-menu.open { display: block; }
.theme-opt {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.82em;
  transition: background 0.1s;
}
.theme-opt:hover { background: var(--bg4); }
.theme-opt.active { background: var(--bg4); }
.theme-swatch { width: 16px; height: 16px; border-radius: 50%; border: 2px solid var(--border); }

/* Theme overrides */
[data-theme="blue"] {
  --accent: #4a9eff; --accent2: #6bb3ff; --border: #1e2e45;
}
[data-theme="green"] {
  --accent: #4ade80; --accent2: #6ee7a0; --border: #1e3528;
}
[data-theme="parchment"] {
  --bg: #f4e8c1; --bg2: #e8d9a8; --bg3: #dccb90; --bg4: #d0bd78;
  --accent: #8b4513; --accent2: #a0522d;
  --text: #2d2416; --text2: #5a4a32; --text3: #8a7a62;
  --border: #c4a86a;
  --gold: #8b6914; --gold2: #a07e1a;
  --blue: #2d5a8b; --green: #2d6b3a; --purple: #5a3d7a;
  --orange: #b06020; --cyan: #1a6b7a;
}

/* === COMPACT MODE === */
.compact-toggle {
  padding: 6px 10px;
  background: transparent;
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text2);
  cursor: pointer;
  font-size: 0.82em;
  transition: all 0.15s;
}
.compact-toggle:hover { border-color: var(--accent); color: var(--text); }
.compact-toggle.active { background: var(--accent); border-color: var(--accent); color: #fff; }

body.compact-mode #home { display: none !important; }
body.compact-mode .tool-section { display: none; }
body.compact-mode #compact-view { display: grid !important; }
#compact-view {
  display: none;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
.compact-panel {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 12px;
  max-height: 50vh;
  overflow-y: auto;
}
.compact-panel h3 { font-size: 0.88em; color: var(--accent); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
.compact-panel .dice-quick { grid-template-columns: repeat(4, 1fr); gap: 4px; }
.compact-panel .dice-btn { padding: 8px 2px; font-size: 0.78em; }
.compact-panel .dice-result { padding: 10px; }
.compact-panel .dice-val { font-size: 2em; }
.compact-panel .oracle-likelihood { grid-template-columns: repeat(5, 1fr); gap: 3px; }
.compact-panel .oracle-btn { padding: 6px 2px; font-size: 0.65em; }
.compact-panel .oracle-result { padding: 12px; min-height: 80px; }
.compact-panel .oracle-answer { font-size: 1.3em; }
.compact-panel .init-item { padding: 6px 8px; gap: 6px; }
.compact-panel .init-item .init-order { font-size: 1em; min-width: 24px; }
.compact-panel .ref-section-head { padding: 6px 10px; }
.compact-panel .ref-item { padding: 6px 10px; }

/* === PWA INSTALL === */
.pwa-install {
  display: none;
  padding: 6px 14px;
  background: var(--accent);
  border: none;
  border-radius: 8px;
  color: #fff;
  cursor: pointer;
  font-size: 0.78em;
  font-weight: 600;
  margin-left: 8px;
}
.pwa-install:hover { background: var(--accent2); }

/* === FOOTER === */
.site-footer {
  text-align: center;
  padding: 20px;
  font-size: 0.75em;
  color: var(--text3);
  border-top: 1px solid var(--border);
}
.site-footer a { color: var(--accent); text-decoration: none; }

/* === RESPONSIVE === */
@media (max-width: 768px) {
  .site-header { padding: 10px 12px; gap: 8px; }
  .site-header h1 { font-size: 1.2em; }
  .site-header h1 span { display: none; }
  .site-nav { gap: 3px; margin-left: 0; }
  .nav-btn { padding: 6px 10px; font-size: 0.75em; }
  main { padding: 16px 12px 60px; }
  .tools-grid { grid-template-columns: 1fr; }
  .tool-card { padding: 14px; }
  .tool-card .tc-icon { font-size: 1.6em; }
  .dice-quick { grid-template-columns: repeat(4, 1fr); }
  .oracle-likelihood { grid-template-columns: repeat(3, 1fr); }
  .npc-stats { grid-template-columns: repeat(3, 1fr); }
  .npc-details { grid-template-columns: 1fr; }
  .enc-params { flex-direction: column; }
  .enc-field input, .enc-field select { width: 100%; }
  .init-item { flex-wrap: wrap; }
  .init-item .init-conds { width: 100%; }
  .journal-layout { grid-template-columns: 1fr; }
  #compact-view { grid-template-columns: 1fr; }
}

@media (max-width: 480px) {
  .oracle-likelihood { grid-template-columns: repeat(3, 1fr); }
  .dice-quick { grid-template-columns: repeat(3, 1fr); }
  .dice-btn.d20 { grid-column: span 1; }
}

/* ============================================
   CHOIR OF FLESH
   ============================================ */
:root {
  --cof-accent: #c41e3a;
  --cof-accent2: #8b0000;
  --cof-flesh: #6b2d2d;
  --cof-choir: #8b6914;
}

/* CoF Nav Button */
.cof-nav { color: var(--cof-accent) !important; }
.cof-nav.active { background: var(--cof-accent) !important; color: #fff !important; }

/* CoF Tool Card */
.cof-card {
  border-color: rgba(196, 30, 58, 0.4) !important;
  background: linear-gradient(135deg, rgba(139, 0, 0, 0.15), var(--bg3)) !important;
}
.cof-card:hover { border-color: var(--cof-accent) !important; }

/* CoF Section Header */
.cof-head h2 { color: var(--cof-accent); }

/* CoF Tabs */
.cof-tabs {
  display: flex;
  gap: 4px;
  padding: 0 16px;
  margin-bottom: 16px;
  overflow-x: auto;
  scrollbar-width: none;
}
.cof-tabs::-webkit-scrollbar { display: none; }
.cof-tab-btn {
  padding: 8px 16px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px 8px 0 0;
  color: var(--text2);
  cursor: pointer;
  font-size: 0.82em;
  white-space: nowrap;
  transition: all 0.2s;
}
.cof-tab-btn:hover { color: var(--text); background: var(--bg4); }
.cof-tab-btn.active {
  background: var(--cof-accent);
  color: #fff;
  border-color: var(--cof-accent);
}
.cof-tab-content { padding: 0 16px 16px; }

/* CoF Panel */
.cof-panel { margin-bottom: 12px; }

/* CoF Character Grid */
.cof-char-grid {
  display: grid;
  gap: 12px;
}

/* CoF Fields */
.cof-field-row { display: flex; gap: 8px; margin-bottom: 8px; flex-wrap: wrap; }
.cof-field { flex: 1; min-width: 120px; }
.cof-field label { display: block; font-size: 0.72em; color: var(--text3); margin-bottom: 2px; text-transform: uppercase; letter-spacing: 0.5px; }
.cof-field input { width: 100%; padding: 6px 8px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 0.85em; }

/* CoF Stats Grid */
.cof-stats-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 6px;
  margin-bottom: 8px;
}
.cof-stat {
  text-align: center;
  padding: 8px 4px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  cursor: pointer;
  transition: border-color 0.2s;
}
.cof-stat:hover { border-color: var(--cof-accent); }
.cof-stat label { display: block; font-size: 0.68em; color: var(--cof-accent); font-weight: 700; letter-spacing: 1px; margin-bottom: 4px; cursor: pointer; }
.cof-stat input {
  width: 100%;
  text-align: center;
  padding: 4px;
  background: transparent;
  border: none;
  color: var(--text);
  font-size: 1.1em;
  font-weight: 700;
}
.cof-stat input:focus { outline: 1px solid var(--cof-accent); border-radius: 4px; }

.cof-derived {
  display: flex;
  justify-content: space-around;
  padding: 6px;
  background: var(--bg2);
  border-radius: 6px;
  font-size: 0.78em;
  color: var(--text2);
}
.cof-derived span { padding: 2px 8px; }

/* CoF Humanity Bar */
.cof-tracker { margin-bottom: 4px; }
.cof-tracker > label { font-size: 0.78em; color: var(--text2); display: block; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
.cof-hum-bar-wrap { display: flex; align-items: center; gap: 8px; }
.cof-hum-bar {
  flex: 1;
  height: 20px;
  background: var(--bg);
  border-radius: 10px;
  overflow: hidden;
  border: 1px solid var(--border);
}
.cof-hum-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--cof-accent), #4ade80);
  border-radius: 10px;
  transition: width 0.3s, background 0.3s;
}
.cof-hum-fill.low { background: linear-gradient(90deg, var(--cof-accent), #fbbf24); }
.cof-hum-fill.critical { background: var(--cof-accent); animation: pulse-red 1s infinite; }
.cof-hum-fill.dead { background: #333; width: 0 !important; }
.cof-hum-val { font-weight: 700; font-size: 1em; min-width: 40px; text-align: center; }

@keyframes pulse-red { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

.cof-tracker-btns { display: flex; gap: 4px; margin-top: 4px; }
.cof-anguish-display { display: flex; align-items: center; gap: 12px; }
.cof-anguish-num { font-size: 1.6em; font-weight: 700; color: var(--cof-accent); min-width: 40px; text-align: center; }

/* CoF Injury Pips */
.cof-pip-row { display: flex; gap: 4px; margin: 4px 0; }
.cof-pip {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 2px solid var(--border);
  cursor: pointer;
  transition: all 0.2s;
}
.cof-pip:hover { border-color: var(--text2); }
.cof-pip.filled { background: var(--cof-accent); border-color: var(--cof-accent); }
.cof-pip.major { border-radius: 4px; }
.cof-pip.major.filled { background: #8b0000; border-color: #8b0000; }
.cof-pip.dead { animation: pulse-red 0.8s infinite; }

.cof-death-alert {
  background: rgba(139, 0, 0, 0.3);
  border: 1px solid var(--cof-accent);
  padding: 10px;
  border-radius: 8px;
  text-align: center;
  color: var(--cof-accent);
  font-weight: 700;
  font-size: 1.1em;
  margin-top: 8px;
  animation: pulse-red 1s infinite;
}

.cof-postcombat { display: flex; align-items: center; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
.cof-postcombat > span { font-size: 0.8em; color: var(--text2); }

/* CoF Usage Dice */
.cof-usage-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px;
  background: var(--bg);
  border-radius: 6px;
  margin-bottom: 4px;
  border: 1px solid var(--border);
}
.cof-usage-item.exhausted { opacity: 0.4; text-decoration: line-through; }
.cof-usage-name { flex: 1; font-size: 0.85em; }
.cof-usage-die { font-weight: 700; color: var(--cof-accent); font-size: 1em; min-width: 30px; text-align: center; }

/* CoF Combat Grid */
.cof-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 2px;
  max-width: 400px;
  margin: 12px auto;
  background: var(--border);
  border: 2px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
}
.cof-cell {
  position: relative;
  aspect-ratio: 1;
  background: var(--bg2);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background 0.15s;
  flex-direction: column;
  gap: 2px;
}
.cof-cell:hover { background: var(--bg4); }
.cof-cell.selected { background: rgba(196, 30, 58, 0.3); outline: 2px solid var(--cof-accent); }
.cof-cell.has-terrain { background: var(--bg3); }
.cof-coord { position: absolute; bottom: 1px; right: 3px; font-size: 0.55em; color: var(--text3); }
.cof-terrain { font-size: 1.1em; }
.cof-token { font-size: 1.3em; }
.cof-token.player { filter: drop-shadow(0 0 3px #4a9eff); }
.cof-token.ally { filter: drop-shadow(0 0 3px #4ade80); }
.cof-token.enemy { filter: drop-shadow(0 0 3px var(--cof-accent)); }

/* Token Images */
.cof-token-img {
  width: 85%;
  height: 85%;
  object-fit: cover;
  border-radius: 50%;
  border: 2px solid var(--border);
  pointer-events: none;
}
.cof-token-img.player { border-color: var(--blue); box-shadow: 0 0 6px rgba(74,158,255,0.5); }
.cof-token-img.ally { border-color: var(--green); box-shadow: 0 0 6px rgba(74,222,128,0.5); }
.cof-token-img.enemy { border-color: var(--cof-accent); box-shadow: 0 0 6px rgba(196,30,58,0.5); }
.cof-cell.dragover { background: rgba(201,162,39,0.2); outline: 2px dashed var(--gold); }

.cof-grid-controls { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 8px; }

/* CoF Travel */
.cof-travel-stats {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  margin-bottom: 12px;
}
.cof-travel-stat {
  text-align: center;
  padding: 10px 6px;
  background: var(--bg);
  border-radius: 8px;
  border: 1px solid var(--border);
}
.cof-travel-stat .label { display: block; font-size: 0.7em; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; }
.cof-travel-stat .value { display: block; font-size: 1.4em; font-weight: 700; color: var(--text); }
.cof-travel-actions { display: flex; gap: 8px; flex-wrap: wrap; }

/* CoF Prayer Buttons */
.cof-prayer-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
.cof-prayer-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 12px;
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  text-align: center;
  color: var(--text);
}
.cof-prayer-btn:hover { border-color: var(--cof-choir); background: var(--bg3); }
.cof-prayer-btn strong { color: var(--cof-choir); font-size: 1em; }
.cof-prayer-btn span { font-size: 0.78em; color: var(--text2); margin: 4px 0; }
.cof-prayer-btn small { font-size: 0.7em; color: var(--text3); }
.cof-prayer-btn.major { border-color: rgba(139, 105, 20, 0.4); }
.cof-prayer-btn.apocalyptic { border-color: rgba(196, 30, 58, 0.4); background: rgba(139, 0, 0, 0.1); }
.cof-prayer-btn.apocalyptic strong { color: var(--cof-accent); }

/* CoF Ascension Effect */
.cof-ascension {
  background: rgba(196, 30, 58, 0.2);
  border: 2px solid var(--cof-accent);
  padding: 12px;
  border-radius: 8px;
  text-align: center;
  font-weight: 700;
  color: var(--cof-accent);
  font-size: 1.1em;
  margin-top: 8px;
  animation: pulse-red 0.8s infinite;
}

/* CoF Mutation */
.cof-mutation {
  background: rgba(107, 45, 45, 0.3);
  border: 1px solid var(--cof-flesh);
  padding: 10px;
  border-radius: 8px;
  margin: 8px 0;
}

/* CoF Result */
.cof-result {
  padding: 12px 16px;
  border-radius: 8px;
  margin-top: 12px;
  font-size: 0.9em;
  line-height: 1.5;
  border: 1px solid var(--border);
  background: var(--bg2);
}
.cof-result.success { border-color: rgba(74, 222, 128, 0.3); background: rgba(74, 222, 128, 0.05); }
.cof-result.critical { border-color: rgba(196, 30, 58, 0.5); background: rgba(139, 0, 0, 0.1); }
.cof-result.info { border-color: rgba(74, 158, 255, 0.3); background: rgba(74, 158, 255, 0.05); }

/* CoF Reference */
.cof-ref-section { margin-bottom: 6px; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
.cof-ref-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 14px;
  background: var(--bg3);
  cursor: pointer;
  font-size: 0.9em;
  font-weight: 600;
  transition: background 0.2s;
}
.cof-ref-header:hover { background: var(--bg4); }
.cof-ref-arrow { color: var(--text3); transition: transform 0.2s; }
.cof-ref-body { padding: 0 14px; background: var(--bg2); }
.cof-ref-item {
  padding: 8px 0;
  border-bottom: 1px solid var(--border);
  font-size: 0.82em;
  line-height: 1.4;
}
.cof-ref-item:last-child { border-bottom: none; }
.cof-ref-item strong { color: var(--cof-accent); display: block; margin-bottom: 2px; }
.cof-ref-item span { color: var(--text2); }

/* CoF Responsive */
@media (min-width: 768px) {
  .cof-char-grid { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 600px) {
  .cof-stats-grid { grid-template-columns: repeat(3, 1fr); }
  .cof-travel-stats { grid-template-columns: repeat(2, 1fr); }
  .cof-prayer-grid { grid-template-columns: 1fr; }
}

/* ============================================
   V3: ANIMATIONS
   ============================================ */
@keyframes dice-bounce { 0% { transform: scale(0.5) rotate(-10deg); opacity: 0; } 50% { transform: scale(1.2) rotate(5deg); } 100% { transform: scale(1) rotate(0); opacity: 1; } }
@keyframes glow-gold { 0%, 100% { box-shadow: 0 0 8px rgba(201, 162, 39, 0.5); } 50% { box-shadow: 0 0 24px rgba(201, 162, 39, 0.9); } }
@keyframes shake { 0%,100% { transform: translateX(0); } 20% { transform: translateX(-6px); } 40% { transform: translateX(6px); } 60% { transform: translateX(-4px); } 80% { transform: translateX(4px); } }
@keyframes flash-white { 0% { opacity: 0; } 20% { opacity: 0.8; } 100% { opacity: 0; } }
@keyframes fadeSlideIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

.dice-val { animation: dice-bounce 0.3s ease-out; }
.dice-result.crit .dice-val { animation: dice-bounce 0.3s ease-out, glow-gold 1s infinite; color: var(--gold); }
.dice-result.fail .dice-val { animation: dice-bounce 0.3s ease-out, shake 0.4s; color: var(--accent); }

.tool-section.active { animation: fadeSlideIn 0.2s ease-out; }

.cof-ascension { animation: pulse-red 0.8s infinite, flash-white 0.3s; }
.cof-result { animation: fadeSlideIn 0.2s ease-out; }

/* ============================================
   V3: UX CONTROLS (header toggles)
   ============================================ */
.ux-controls {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-left: auto;
}
.ux-toggle {
  background: transparent;
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--text2);
  cursor: pointer;
  padding: 4px 8px;
  font-size: 0.75em;
  transition: all 0.2s;
  white-space: nowrap;
}
.ux-toggle:hover { border-color: var(--text2); color: var(--text); }
.ux-toggle.active { background: var(--accent); border-color: var(--accent); color: #fff; }

/* ============================================
   V4: AUTH & SYNC
   ============================================ */
.auth-panel {
  display: flex;
  align-items: center;
  gap: 6px;
}
.auth-btn {
  padding: 4px 10px;
  background: transparent;
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--text2);
  cursor: pointer;
  font-size: 0.75em;
  transition: all 0.15s;
  white-space: nowrap;
}
.auth-btn:hover { border-color: var(--accent); color: var(--text); }
.auth-logout { font-size: 0.85em; padding: 4px 6px; }
.auth-user {
  display: flex;
  align-items: center;
  gap: 6px;
}
.auth-avatar {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: 1px solid var(--border);
}
.auth-name {
  font-size: 0.72em;
  color: var(--text2);
  max-width: 80px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.sync-indicator {
  font-size: 0.85em;
  transition: all 0.3s;
  display: inline-block;
}
.sync-indicator.syncing {
  animation: spin 1s linear infinite;
  color: var(--gold);
}
.sync-indicator.done { color: var(--green); }
.sync-indicator.error { color: var(--accent); }
.sync-indicator.idle { color: var(--text3); }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

@media (max-width: 768px) {
  .auth-name { display: none; }
  .auth-sync { display: none; }
}

/* ============================================
   V3: BACKUP PANEL
   ============================================ */
.backup-panel {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}
.backup-panel.open { display: flex; }
.backup-box {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  max-width: 400px;
  width: 90%;
}
.backup-box h3 { margin-bottom: 16px; }
.backup-box .input-row { margin-bottom: 12px; }

/* ============================================
   V3: MOBILE BOTTOM BAR
   ============================================ */
.mobile-bar {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--bg2);
  border-top: 1px solid var(--border);
  padding: 6px 8px env(safe-area-inset-bottom);
  z-index: 900;
  justify-content: space-around;
}
.mobile-bar button {
  background: transparent;
  border: none;
  color: var(--text2);
  font-size: 1.3em;
  padding: 6px 12px;
  cursor: pointer;
  border-radius: 8px;
  transition: all 0.15s;
}
.mobile-bar button:active { background: var(--bg4); transform: scale(0.95); }

@media (max-width: 768px) {
  .mobile-bar { display: flex; }
  body { padding-bottom: 56px; }
  .site-nav { overflow-x: auto; scrollbar-width: none; -webkit-overflow-scrolling: touch; scroll-snap-type: x mandatory; }
  .site-nav::-webkit-scrollbar { display: none; }
  .nav-btn { scroll-snap-align: start; min-width: max-content; min-height: 44px; }
  .btn, .dice-btn, .oracle-btn { min-height: 44px; }
}

/* ============================================
   V3: SPELL TRACKER
   ============================================ */
.spell-slots-grid { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 12px; }
.spell-level { background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 8px 12px; min-width: 80px; text-align: center; }
.spell-level-label { font-size: 0.7em; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; display: block; margin-bottom: 4px; }
.spell-pips { display: flex; gap: 3px; justify-content: center; }
.spell-pip {
  width: 18px; height: 18px;
  border-radius: 50%;
  border: 2px solid var(--purple);
  cursor: pointer;
  transition: all 0.15s;
}
.spell-pip:hover { border-color: var(--text); }
.spell-pip.used { background: var(--purple); }
.spell-config { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
.prepared-list { max-height: 300px; overflow-y: auto; }
.prepared-item { display: flex; align-items: center; gap: 8px; padding: 6px 8px; border-bottom: 1px solid var(--border); font-size: 0.85em; }
.prepared-item .spell-lvl { color: var(--purple); font-weight: 700; min-width: 20px; }
.concentration-badge { background: rgba(167, 139, 250, 0.2); color: var(--purple); padding: 2px 8px; border-radius: 4px; font-size: 0.75em; font-weight: 600; }

/* ============================================
   V3: LOOT GENERATOR
   ============================================ */
.loot-result { padding: 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; margin-top: 12px; }
.loot-coins { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 10px; }
.loot-coin { font-size: 0.85em; }
.loot-coin .amount { font-weight: 700; }
.loot-coin.gp { color: var(--gold); }
.loot-coin.sp { color: #c0c0c0; }
.loot-coin.cp { color: #cd7f32; }
.loot-coin.pp { color: #e5e4e2; }
.loot-coin.ep { color: #b0b0b0; }
.loot-items { list-style: none; padding: 0; }
.loot-items li { padding: 4px 0; border-bottom: 1px solid var(--border); font-size: 0.85em; }
.loot-items li:last-child { border: none; }
.loot-rarity-common { color: var(--text); }
.loot-rarity-uncommon { color: var(--green); }
.loot-rarity-rare { color: var(--blue); }
.loot-rarity-veryrare { color: var(--purple); }
.loot-rarity-legendary { color: var(--gold); }

/* ============================================
   V3: DUNGEON GENERATOR
   ============================================ */
.dungeon-map { display: flex; flex-direction: column; gap: 4px; }
.dungeon-room {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 10px 14px;
  cursor: pointer;
  transition: all 0.15s;
}
.dungeon-room:hover { border-color: var(--accent); }
.dungeon-room.expanded { background: var(--bg2); }
.dungeon-room-header { display: flex; justify-content: space-between; align-items: center; }
.dungeon-room-num { font-weight: 700; color: var(--accent); margin-right: 8px; }
.dungeon-room-type { font-size: 0.78em; color: var(--text2); }
.dungeon-room-icon { font-size: 1.1em; }
.dungeon-room-details { margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); font-size: 0.85em; color: var(--text2); display: none; }
.dungeon-room.expanded .dungeon-room-details { display: block; }
.dungeon-connections { font-size: 0.75em; color: var(--text3); margin-top: 4px; }

/* ============================================
   V3: COF SETTLEMENT
   ============================================ */
.cof-settlement-stats { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 12px; }
.cof-settle-stat { text-align: center; padding: 10px; background: var(--bg); border-radius: 8px; border: 1px solid var(--border); }
.cof-settle-stat .label { display: block; font-size: 0.7em; color: var(--text3); text-transform: uppercase; }
.cof-settle-stat .value { display: block; font-size: 1.3em; font-weight: 700; }
.cof-building-list { max-height: 250px; overflow-y: auto; }
.cof-building-item { display: flex; align-items: center; gap: 8px; padding: 8px; border-bottom: 1px solid var(--border); font-size: 0.85em; }
.cof-building-icon { font-size: 1.2em; }
.cof-building-name { font-weight: 600; min-width: 80px; }
.cof-building-effect { flex: 1; color: var(--text2); font-size: 0.85em; }
@media (max-width: 768px) {
  .cof-settlement-stats { grid-template-columns: repeat(3, 1fr); }
}

/* COF Incursion Grid */
.cof-incursion-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 4px;
  max-width: 500px;
  margin: 12px auto;
}
.cof-inc-cell {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 12px 8px;
  text-align: center;
  cursor: pointer;
  transition: all 0.15s;
  min-height: 80px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
}
.cof-inc-cell:hover { border-color: var(--cof-accent); transform: scale(1.03); }
.cof-inc-cell.empty { border-style: dashed; }
.cof-inc-cell.empty .cof-inc-unknown { font-size: 2em; color: var(--text3); }
.cof-inc-cell.revealed { background: var(--bg2); border-color: var(--cof-accent); }
.cof-inc-label { font-size: 0.65em; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; }
.cof-inc-poi { font-size: 0.75em; color: var(--text2); line-height: 1.3; }
